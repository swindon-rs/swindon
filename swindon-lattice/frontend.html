
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Frontend API Reference &#8212; Swindon 0.7.8 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Upstream backend requirements" href="upstream.html" />
    <link rel="prev" title="CRDT Types" href="crdt.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="frontend-api-reference">
<h1>Frontend API Reference<a class="headerlink" href="#frontend-api-reference" title="Permalink to this headline">¶</a></h1>
<p>Javascript/browser client connects to the swindon via websocket. We authorize
websocket by headers (<code class="docutils literal"><span class="pre">Cookie</span></code>, <code class="docutils literal"><span class="pre">Authorization</span></code>, <code class="docutils literal"><span class="pre">request-uri</span></code>,
or any other header) and then we keep that authorization data for future
requests via same websocket.</p>
<p>On top of the websockets we implement request-reply pattern from client
to server and multiple patterns from server to client.</p>
<div class="section" id="request-format">
<h2>Request Format<a class="headerlink" href="#request-format" title="Permalink to this headline">¶</a></h2>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nx">method</span><span class="p">,</span> <span class="nx">request_meta</span><span class="p">,</span> <span class="nx">args_array</span><span class="p">,</span> <span class="nx">kwargs_object</span><span class="p">]</span>
</pre></div>
</div>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">method</span></code></dt>
<dd>Name of the remote method to call (example: <code class="docutils literal"><span class="pre">&quot;chat.send_message&quot;</span></code>).
Names starting with <code class="docutils literal"><span class="pre">tangle.*</span></code> and <code class="docutils literal"><span class="pre">swindon.*</span></code> are reserved and cannot
be called from client.</dd>
</dl>
<dl class="docutils" id="request-meta">
<dt><code class="docutils literal"><span class="pre">request_meta</span></code></dt>
<dd><p class="first">A dictionary (technically a Javascript/JSON object) that contains metadata
of the request. All fields that are passed in this object are returned
in <code class="docutils literal"><span class="pre">response_meta</span></code>.</p>
<p>Currently there are the following well-known fields:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt><code class="docutils literal"><span class="pre">request_id</span></code></dt>
<dd>This field contains request identified. Swindon itself uses the
field barely for logging purposes. But it’s inteded to be used to
match responses on the frontend. It should be either non-negative
integer or ascii string up to 36 chars long
(with valid characters <code class="docutils literal"><span class="pre">a-z</span></code>, <code class="docutils literal"><span class="pre">A-Z</span></code>, <code class="docutils literal"><span class="pre">0-9</span></code>, <code class="docutils literal"><span class="pre">-</span></code>, <code class="docutils literal"><span class="pre">_</span></code>).</dd>
<dt><code class="docutils literal"><span class="pre">active</span></code></dt>
<dd>Time (in seconds) for which session should be considered active.
This should be positive integer.</dd>
</dl>
</div></blockquote>
</dd>
<dt><code class="docutils literal"><span class="pre">args_array</span></code></dt>
<dd>Positional arguments for the remote method. They are passed to the backend
as is (must be a valid JSON array though).</dd>
<dt><code class="docutils literal"><span class="pre">kwargs_object</span></code></dt>
<dd>Named arguments for the remote method (must be valid JSON object).</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All four arguments are <strong>required</strong> even if some of them are empty.</p>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Request:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;chat.send_message&quot;</span><span class="p">,</span>
 <span class="p">{</span><span class="nt">&quot;request_id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">},</span>
 <span class="p">[{</span><span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Arbitrary message&quot;</span><span class="p">}],</span>
 <span class="p">{</span><span class="nt">&quot;room&quot;</span><span class="p">:</span> <span class="s2">&quot;room1&quot;</span><span class="p">}</span>
 <span class="p">]</span>
</pre></div>
</div>
<p>Possible responses:</p>
<p><em>Success result:</em></p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nt">&quot;request_id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">},</span> <span class="p">{</span><span class="nt">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="nt">&quot;object&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
</pre></div>
</div>
<p><em>Error results:</em></p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nt">&quot;request_id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="nt">&quot;tangle_code&quot;</span><span class="p">:</span> <span class="s2">&quot;http_error&quot;</span><span class="p">,</span> <span class="nt">&quot;error_code&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">},</span>
 <span class="p">{</span><span class="nt">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="nt">&quot;object&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
</pre></div>
</div>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nt">&quot;request_id&quot;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="nt">&quot;tangle_code&quot;</span><span class="p">:</span> <span class="s2">&quot;validation_error&quot;</span><span class="p">},</span>
 <span class="p">{</span><span class="nt">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="nt">&quot;object&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="response-format">
<h2>Response Format<a class="headerlink" href="#response-format" title="Permalink to this headline">¶</a></h2>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nx">event_type</span><span class="p">,</span> <span class="nx">response_meta</span><span class="p">,</span> <span class="nx">data</span><span class="p">]</span>
</pre></div>
</div>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">event_type</span></code></dt>
<dd>Event type (see <a class="reference internal" href="#event-types">Event Types</a>)</dd>
<dt><code class="docutils literal"><span class="pre">response_meta</span></code></dt>
<dd><p class="first">A dictionary (a object in terms of Javascript/JSON) that contains
auxilliary data about the event.</p>
<p class="last">For responses this dictionary contains fields from <code class="docutils literal"><span class="pre">request_meta</span></code></p>
</dd>
<dt><code class="docutils literal"><span class="pre">data</span></code></dt>
<dd>Event data. Type and format of this value depends on <code class="docutils literal"><span class="pre">event_type</span></code></dd>
</dl>
</div>
<div class="section" id="event-types">
<h2>Event Types<a class="headerlink" href="#event-types" title="Permalink to this headline">¶</a></h2>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#method-call-result-result-error" id="id1">Method Call Result (<code class="docutils literal"><span class="pre">result</span></code>/<code class="docutils literal"><span class="pre">error</span></code>)</a></li>
<li><a class="reference internal" href="#user-information-hello" id="id2">User Information (<code class="docutils literal"><span class="pre">hello</span></code>)</a></li>
<li><a class="reference internal" href="#fatal-errors-fatal-error" id="id3">Fatal Errors (<code class="docutils literal"><span class="pre">fatal_error</span></code>)</a></li>
<li><a class="reference internal" href="#message-message" id="id4">Message (<code class="docutils literal"><span class="pre">message</span></code>)</a></li>
<li><a class="reference internal" href="#lattice-update-lattice" id="id5">Lattice Update (<code class="docutils literal"><span class="pre">lattice</span></code>)</a></li>
</ul>
</div>
<div class="section" id="method-call-result-result-error">
<span id="call-result"></span><h3><a class="toc-backref" href="#id1">Method Call Result (<code class="docutils literal"><span class="pre">result</span></code>/<code class="docutils literal"><span class="pre">error</span></code>)</a><a class="headerlink" href="#method-call-result-result-error" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">event_type:</th><td class="field-body"><code class="docutils literal"><span class="pre">result</span></code></td>
</tr>
</tbody>
</table>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;request_id&quot;</span><span class="o">:</span> <span class="mi">123</span><span class="p">},</span> <span class="nx">json_result_object</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Error result</strong></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">event_type:</th><td class="field-body"><code class="docutils literal"><span class="pre">error</span></code></td>
</tr>
</tbody>
</table>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
 <span class="p">{</span><span class="s2">&quot;request_id&quot;</span><span class="o">:</span> <span class="mi">123</span><span class="p">,</span> <span class="s2">&quot;error_kind&quot;</span><span class="o">:</span> <span class="s2">&quot;http_error&quot;</span><span class="p">,</span> <span class="s2">&quot;http_error&quot;</span><span class="o">:</span> <span class="mi">400</span><span class="p">},</span>
 <span class="nx">json_body_object</span><span class="p">]</span>

<span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
 <span class="p">{</span><span class="s2">&quot;request_id&quot;</span><span class="o">:</span> <span class="mi">123</span><span class="p">,</span> <span class="s2">&quot;error_kind&quot;</span><span class="o">:</span> <span class="s2">&quot;validation_error&quot;</span><span class="p">},</span>
 <span class="s2">&quot;invalid method&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>In case of error <code class="docutils literal"><span class="pre">response_meta</span></code> always has <code class="docutils literal"><span class="pre">error_kind</span></code> field.
Other fields may contain error details depending on the type of error.</p>
<p>Possible <code class="docutils literal"><span class="pre">error_kind</span></code> values:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal"><span class="pre">http_error</span></code></dt>
<dd>HTTP error from backend server. This error contains additional field
<code class="docutils literal"><span class="pre">http_error</span></code> which contains <em>HTTP status code</em>. The <code class="docutils literal"><span class="pre">data</span></code> field
may contain error data if response has
<code class="docutils literal"><span class="pre">Content-Type:</span> <span class="pre">application/json</span></code> and valid JSON body.</dd>
<dt><code class="docutils literal"><span class="pre">validation_error</span></code></dt>
<dd>Error validating request. <code class="docutils literal"><span class="pre">data</span></code> contains addition information.</dd>
<dt><code class="docutils literal"><span class="pre">data_error</span></code></dt>
<dd><p class="first">Error related to decoding response from a backend.
<code class="docutils literal"><span class="pre">data</span></code> field contains string describing an error.
Possible causes:</p>
<ul class="last simple">
<li>wrong (unsupported) <code class="docutils literal"><span class="pre">Content-Type</span></code> header;</li>
<li>not a JSON or malformed JSON response;</li>
</ul>
</dd>
<dt><code class="docutils literal"><span class="pre">internal_error</span></code></dt>
<dd>Swindon encountered internal error while processing the request.
<code class="docutils literal"><span class="pre">data</span></code> field contains string describing an error.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="user-information-hello">
<span id="hello-message"></span><h3><a class="toc-backref" href="#id2">User Information (<code class="docutils literal"><span class="pre">hello</span></code>)</a><a class="headerlink" href="#user-information-hello" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">event_type:</th><td class="field-body"><code class="docutils literal"><span class="pre">hello</span></code></td>
</tr>
</tbody>
</table>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span><span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">}]</span>
</pre></div>
</div>
<p>Initial event sent just after websocket handshake is complete, which
in turn means backend has authorized connection.</p>
<p>Format of the data sent (third item in the tuple above) is defined
by a backend (i.e. it’s JSON data sent from a backend).
See <span class="xref std std-ref">backend-auth</span> for more info.</p>
</div></blockquote>
</div>
<div class="section" id="fatal-errors-fatal-error">
<span id="fatal-error-message"></span><h3><a class="toc-backref" href="#id3">Fatal Errors (<code class="docutils literal"><span class="pre">fatal_error</span></code>)</a><a class="headerlink" href="#fatal-errors-fatal-error" title="Permalink to this headline">¶</a></h3>
<p>Fatal errors are very similar to method call errors, but they close connection
after being received. Usually, fatal error is encountered when connection
is first established (i.e. instead of <code class="docutils literal"><span class="pre">hello</span></code>), but may also appear later.</p>
<p>Many fatal error are also duplicated by <span class="xref std std-ref">websocket shutdown codes</span>, but
some browsers do not expose them to the application.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;fatal_error&quot;</span><span class="p">,</span>
 <span class="p">{</span><span class="s2">&quot;error_kind&quot;</span><span class="p">:</span> <span class="s2">&quot;http_error&quot;</span><span class="p">,</span> <span class="s2">&quot;http_error&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">},</span>
 <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;sent&quot;</span><span class="p">,</span> <span class="s2">&quot;by&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="s2">&quot;handler&quot;</span><span class="p">]}]</span>
</pre></div>
</div>
</div>
<div class="section" id="message-message">
<span id="front-message"></span><h3><a class="toc-backref" href="#id4">Message (<code class="docutils literal"><span class="pre">message</span></code>)</a><a class="headerlink" href="#message-message" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">event_type:</th><td class="field-body"><code class="docutils literal"><span class="pre">message</span></code></td>
</tr>
</tbody>
</table>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">,</span>
 <span class="p">{</span><span class="nt">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;test-chat.room1&quot;</span><span class="p">},</span>
 <span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;..&quot;</span>
  <span class="p">}]</span>
</pre></div>
</div>
<p>This message type is used to propagate published messages to frontend.
See <a class="reference internal" href="backend.html#topic-publish"><span class="std std-ref">Pub/Sub subscriptions</span></a> for more info.</p>
</div></blockquote>
</div>
<div class="section" id="lattice-update-lattice">
<h3><a class="toc-backref" href="#id5">Lattice Update (<code class="docutils literal"><span class="pre">lattice</span></code>)</a><a class="headerlink" href="#lattice-update-lattice" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>More about lattice updates in <a class="reference internal" href="lattices.html#lattice-definition"><span class="std std-ref">Lattices</span></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">event_type:</th><td class="field-body"><code class="docutils literal"><span class="pre">lattice</span></code></td>
</tr>
</tbody>
</table>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;lattice&quot;</span><span class="p">,</span>
 <span class="p">{</span><span class="nt">&quot;namespace&quot;</span><span class="p">:</span> <span class="s2">&quot;test-chat.rooms&quot;</span><span class="p">},</span>
 <span class="p">{</span>
   <span class="nt">&quot;room1&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="nt">&quot;last_message_count&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
     <span class="nt">&quot;last_seen_count&quot;</span><span class="p">:</span> <span class="mi">3</span>
   <span class="p">},</span>
   <span class="nt">&quot;room2&quot;</span><span class="p">:</span> <span class="p">{</span>
     <span class="nt">&quot;last_message_count&quot;</span><span class="p">:</span> <span class="mi">123</span>
   <span class="p">},</span>
<span class="p">}]</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/swindon.jpg" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Frontend API Reference</a><ul>
<li><a class="reference internal" href="#request-format">Request Format</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#response-format">Response Format</a></li>
<li><a class="reference internal" href="#event-types">Event Types</a><ul>
<li><a class="reference internal" href="#method-call-result-result-error">Method Call Result (<code class="docutils literal"><span class="pre">result</span></code>/<code class="docutils literal"><span class="pre">error</span></code>)</a></li>
<li><a class="reference internal" href="#user-information-hello">User Information (<code class="docutils literal"><span class="pre">hello</span></code>)</a></li>
<li><a class="reference internal" href="#fatal-errors-fatal-error">Fatal Errors (<code class="docutils literal"><span class="pre">fatal_error</span></code>)</a></li>
<li><a class="reference internal" href="#message-message">Message (<code class="docutils literal"><span class="pre">message</span></code>)</a></li>
<li><a class="reference internal" href="#lattice-update-lattice">Lattice Update (<code class="docutils literal"><span class="pre">lattice</span></code>)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Swindon-lattice Protocol</a><ul>
      <li>Previous: <a href="crdt.html" title="previous chapter">CRDT Types</a></li>
      <li>Next: <a href="upstream.html" title="next chapter">Upstream backend requirements</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/swindon-lattice/frontend.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Evo Company.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/swindon-lattice/frontend.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>