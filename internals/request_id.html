
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Request Id &#8212; Swindon 0.7.8 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Load Balancing" href="load_balancing.html" />
    <link rel="prev" title="Swindon Internals" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="request-id">
<h1>Request Id<a class="headerlink" href="#request-id" title="Permalink to this headline">¶</a></h1>
<p>Currently we have a single algorithm for generating unique request identifiers,
in future we may add other ones if they are required.</p>
<p>99 percent of the time you should treat request_ids as opaque strings, so
this documentation is just for your info.</p>
<div class="section" id="generation">
<h2>Generation<a class="headerlink" href="#generation" title="Permalink to this headline">¶</a></h2>
<p>Request id as generated by swindon is 32bytes of url-safe base64 chars
(alphanumeric characters + <code class="docutils literal"><span class="pre">-</span></code> and <code class="docutils literal"><span class="pre">_</span></code>, no padding as we fit base64
exactly).</p>
<p>Request id is generated from 24 bytes of data consisting of three parts:</p>
<ol class="arabic simple">
<li>Current timestamp in milliseconds, wrapped at 6 bytes
(will wrap in 8k years)</li>
<li>12 bytes of random data, which are thread id which accepted thread. These
bytes are not synchronized between threads and workers, but it’s assumed
that 96 bits of random data is enough to have clashes improbable.</li>
<li>A per-thread sequence number of request id which wraps at 6 bytes</li>
</ol>
<p>As you can see you can guess the timestamp from the request id, and request
id’s are also k-ordered, i.e. you can sort them alphanumerically and get
estimation of sequence of running requests.</p>
</div>
<div class="section" id="request-id-propagation">
<h2>Request Id Propagation<a class="headerlink" href="#request-id-propagation" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you may want to get request id from another system, this is on
our to do list.</p>
</div>
<div class="section" id="q-a">
<h2>Q &amp; A<a class="headerlink" href="#q-a" title="Permalink to this headline">¶</a></h2>
<p><strong>Why request-id is not an uuid4?</strong></p>
<p>There are few reasons:</p>
<ul class="simple">
<li>Because usually uuid4 is fetched from good random generator source, but
we will quickly drain system’s random generator if we use it for every
request id. Using PRNG for the task is possible, but that approach doesn’t
look like superior to what we have now.</li>
<li>It’s good to have k-ordered request ids and to know timestamp when request
id was generated. Thread id and number may provide additional aid in
debugging few kinds of issues (like server crashes and recovery)</li>
<li>Also our request-ids are shorter, while providing additional info</li>
</ul>
<p>Downsides:</p>
<ul class="simple">
<li>Request id provides some info that may be useful for attacker to do some
harm. So you should <strong>not</strong> expose request ids to users.</li>
</ul>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/swindon.jpg" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Request Id</a><ul>
<li><a class="reference internal" href="#generation">Generation</a></li>
<li><a class="reference internal" href="#request-id-propagation">Request Id Propagation</a></li>
<li><a class="reference internal" href="#q-a">Q &amp; A</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Swindon Internals</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Swindon Internals</a></li>
      <li>Next: <a href="load_balancing.html" title="next chapter">Load Balancing</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/internals/request_id.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Evo Company.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/internals/request_id.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>